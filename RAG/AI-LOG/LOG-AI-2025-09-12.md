---
node_id: LOG-AI-2025-09-12
tags:
  - AI-log
  - development-summary
  - contracts
  - graph
  - path
  - search
  - gtd
  - filters
  - ci
closed_tickets:
  - AI-IMP-002
created_date: 2025-09-12
related_files:
  - src/commands/graph.rs
  - src/commands/path.rs
  - src/commands/search.rs
  - src/commands/info.rs
  - src/cli.rs
  - src/bin/cli-rag.rs
  - contracts/v1/cli/graph.schema.json
  - contracts/v1/cli/path.schema.json
  - contracts/changelog.md
  - .github/workflows/ci.yml
  - tests/integration_graph_json.rs
  - tests/integration_path_json.rs
  - tests/integration_search_gtd.rs
  - tests/integration_search_filters.rs
confidence_score: 0.93
---

# 2025-09-12-LOG-AI-phase-2-and-3-search-gtd

## Work Completed
- Added protocolVersion to graph/path contracts and emitters; updated changelog and tests.
- Completed Graph/Path alignment to contracts: deterministic nodes/edges, edge kind, schema inference.
- Wired CI validations for graph/path and added fixture cases including mentions with locations.
- Aligned search surface to envelope `{results:[...]}` per contract and updated tests accordingly.
- Implemented GTD enrichments in search: emits note, todo (from body), and kanban (from frontmatter).
- Introduced search filters: `--kind`, `--schema`, `--status`, `--tag`; added simple scoring and deterministic sort.
- Exposed capabilities in `info` (gtdTasks, kanban).
- Extended CI to validate search outputs (note + todo/kanban fixtures) against schema.

## Issues Encountered
- Contracts directory paths: standardized CI to use `contracts/v1/...` to match v1 folder and `$id`s.
- Envelope shift: legacy tests assumed bare array for search; updated to `{results:[...]}` consistently.
- Clippy `too_many_arguments` on `search::run`; allowed locally to keep handler stable while filters are experimental.
- Formatting: rustfmt preferred multi-line chains and assertions; adjusted code/tests to satisfy pre-commit (fmt, clippy, line-length).

## Tests Added
- `tests/integration_graph_json.rs` and `tests/integration_path_json.rs`: assert protocolVersion and contract shapes.
- `tests/integration_search_gtd.rs`: verifies todo extraction from body and kanban from frontmatter.
- `tests/integration_search_filters.rs`: verifies `--kind` filtering for notes and todos.
- CI fixtures: added schema validations for search (note and todo+kanban) in workflow.

## Next Steps
- Monitor filter set in practice; consider adding date-range/status/tag combinators as needed.
- Optionally refine scoring (multi-token weighting, content snippets) per conventions.
- Proceed to remaining Phase 3 items as prioritized (GTD emitter polish, additional search filters if justified).
