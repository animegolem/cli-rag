#!/usr/bin/env bash
set -euo pipefail

echo "[pre-commit] Running cargo fmt check..."
cargo fmt --all -- --check

echo "[pre-commit] Running clippy (deny warnings)..."
cargo clippy --all-targets --all-features -- -D warnings

echo "[pre-commit] Running line-length guard..."
scripts/line_guard.sh

echo "[pre-commit] Running tests (unit+integration)..."
# Run the test suite to catch regressions locally. Use PRECOMMIT_SKIP_TESTS=1 to skip.
if [ "${PRECOMMIT_SKIP_TESTS:-0}" != "1" ]; then
  cargo test --tests --quiet
fi

echo "[pre-commit] OK"
