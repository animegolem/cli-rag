---
node_id: LOG-AI-2025-09-16
tags:
  - AI-log
  - development-summary
  - ai-index
  - ci
  - contracts
  - config
  - init
closed_tickets:
  - AI-IMP-011
  - AI-IMP-012
  - AI-IMP-013
created_date: 2025-09-16
related_files:
  - src/commands/ai_index_plan.rs
  - src/commands/ai_index_apply.rs
  - src/commands/info.rs
  - src/commands/validate_cmd.rs
  - src/commands/init.rs
  - src/config/template.rs
  - src/config/loader.rs
  - .github/workflows/ci.yml
  - tests/integration_ai_index_plan.rs
  - tests/integration_ai_index_apply.rs
  - tests/integration_config_version.rs
  - docs/RAG/BRIDGE_PLAN_V1.md
  - docs/RAG/BRIDGE_PLAN_V2.md
  - docs/RAG/AI-IMP/AI-IMP-011-surface-cleanup-and-capability-gating.md
  - docs/RAG/AI-IMP/AI-IMP-012-ci-gates-for-ai-index-and-lua-smoke.md
  - docs/RAG/AI-IMP/AI-IMP-013-config-versioning-and-exposure.md
  - docs/RAG/AI-EPIC/AI-EPIC-001-contracts-convergence-and-dogfooding.md
  - docs/RAG/AI-IMP/AI-IMP-014-nested-user-config-loader.md
  - docs/RAG/AI-IMP/AI-IMP-015-new-id-generator-and-filename-template.md
  - docs/RAG/AI-IMP/AI-IMP-016-frontmatter-policy-gtd-and-user-system.md
  - docs/RAG/AI-IMP/AI-IMP-017-overlay-provenance-in-resolved-and-info.md
  - docs/RAG/AI-IMP/AI-IMP-018-ai-new-start-submit-cancel-list.md
  - docs/RAG/AI-IMP/AI-IMP-019-ci-gates-for-new-ai-new-and-nested-config.md
  - docs/RAG/AI-IMP/AI-IMP-020-dogfooding-migrate-config-and-use-new.md
confidence_score: 0.92
---

# 2025-09-16-LOG-AI-ai-index-ci-and-config-versioning-wrap-up

## Work Completed
- ai-index apply: finalized behavior (cache write, additive tags, exit codes) and fixed CLI flag handling in tests; derived tags from label when plan.tags absent. All ai-index integration tests green.
- Surface cleanup (IMP-11): removed legacy `topics` and `group` commands; eliminated groups writes; updated help/README; ensured watch NDJSON examples correct.
- Capability gating: flipped `info.capabilities.aiIndex` to true after CI gates were added; README example updated.
- CI gates (IMP-12): added schema validations for `ai-index-plan` and `ai-index-apply` (dry + non-dry), and a Lua overlay smoke test (enabled vs `--no-lua`). Fixed Windows checkout issue by renaming a template (removed `*`), and stabilized JSON capture by writing apply report to a file.
- Config versioning (IMP-13): added `config_version` to Config (default "0.1"); surfaced in `info` and `.cli-rag/resolved.json`; added integration tests.
- Init alignment: refreshed default template to add `config_version`, remove groups, and align comments/paths with current state.
- Planning: created EPIC (contracts convergence + dogfooding) and seeded IMP-014..020 for nested config loader, authoring features, overlays provenance, ai new flows, CI gates, and repo dogfooding.

## Session Commits
- 2cb51f8 docs(EPIC+IMPs): add AI-EPIC-001 meta plan and seed IMP-014..020 tickets for contracts convergence and dogfooding
- 12a8afd init/template: align default .cli-rag.toml to current state (add config_version, remove groups_relative, update comments and filepaths); drop stray config_version hint from inline schema block
- 1d01ecb docs: mark IMP-013 done; update Bridge Plans V1/V2 to reflect completed ai-index apply, capability gating, groups removal, CI gates, and config versioning
- 21ed705 feat(IMP-013): add config_version to config; default via loader; surface in info and resolved.json; add integration tests
- fa6e769 docs(IMP-11,12): mark completed; set kanban_status=done and close_date; update checklists
- cc0919e ci(IMP-12): add Lua overlay smoke (enabled and --no-lua) in contracts job
- b70e6ab fix(ci): avoid Windows-invalid '*' filename by renaming template; adjust ADR link; make apply-report parsing robust by writing to file in workflow
- 3a81dcd feat(info): flip capabilities.aiIndex to true and update README example
- 0f0d370 ci(IMP-12): add ai-index plan/apply gates (schema checks, dry-run + non-dry writes) to contracts workflow
- cb29c9a docs: update README help for watch NDJSON event schema; remove groups_written; fix ai-index-apply usage flags; expand info capabilities example
- fd01ab0 feat(IMP-011): remove group/topics commands and groups writes per ADR-003d; keep capability gating in info; update tests and docs
- 1a68be1 feat(ai-index): implement plan/apply; cache+additive tags; docs+tests; clippy clean

## Issues Encountered
- Windows path constraints: a template path containing `*` caused checkout failure on `windows-latest`; resolved by renaming the file and updating references.
- Clap bool flags: tests erroneously passed `--write-frontmatter true`; updated tests to use the flag form and fixed derive-tags logic to require absence of plan.tags.
- CI JSON parsing: capturing apply report via shell variable led to an empty string in some contexts; stabilized by redirecting to a file and validating against the schema.
- Clippy/test noise: removed unused imports and `len() >= 1` warnings; aligned tests with idiomatic patterns.

## Tests Added
- ai-index: integration tests for plan shape/determinism, apply dry-run, frontmatter write, and hash mismatch exit 2.
- config_version: integration test ensuring `info` and `resolved.json` reflect explicit and default versions.
- CI: contracts job now validates ai-index plan/apply outputs and overlay enable/disable paths.

## Next Steps
- Begin EPIC AI-EPIC-001 execution:
  - AI-IMP-014: nested user_config loader convergence; add CI acceptance step.
  - AI-IMP-015: `new` id_generator + filename_template; tests.
  - AI-IMP-016: frontmatter GTD/user-system policy and validate.
  - AI-IMP-018: minimal `ai new` flows; contracts-aligned JSON.
- Dogfooding: plan for migrating this repoâ€™s `.cli-rag.toml` to nested shape and adopting `new` for ADR/IMP/EPIC authoring once 014/015 land.
