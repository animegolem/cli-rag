---
node_id: IMP-AI-002
tags:
  - config
  - versioning
kanban_status:
  - planned
kanban_statusline: Introduce config_version with deprecation warnings and an upgrade helper.
depends_on:
  - ADR-004
blocked_by: []
created_date: 2025-08-30
related_files:
  - src/config.rs
  - src/commands/init.rs
---

# IMP-AI-002-config-versioning-and-upgrade

### **Goal**
Introduce `config_version` with version-aware parsing and non-blocking deprecation warnings; provide an upgrade scaffold so users can migrate configs safely.

### **Context**
ADR-004 calls for explicit versioning so we can evolve the config DSL without breaking users. Older configs must continue to work with clear warnings and a path to upgrade; new projects should be scaffolded with the current version for consistency.

### **Implementation Plan**
- [ ] Add `config_version` to the top-level config struct; choose current (e.g., "0.3") as default when absent.
- [ ] Version-aware parsing: support legacy keys behind deprecated parsers with `since` metadata; emit a single consolidated WARNING describing end-of-support.
- [ ] `init --schema` scaffold includes `config_version` and comments about compatibility.
- [ ] CLI helper stub: `adr-rag config upgrade` (or `init --upgrade <path>`), reading older config and rewriting updated keys (no-op for current version).
- [ ] Tests: missing version (defaults), old version (warning), new version (no warning), and upgrade rewrite sanity.

### **Acceptance Criteria**
- Running with a v0.1/v0.2 config prints a deprecation warning but commands function normally.
- New configs generated by `init` include `config_version` set to current and pass `validate`.
- Upgrade helper produces an updated file with the newer key names and increments `config_version`.
- All behaviors are covered by unit tests with stable messages.

### **Takeaway**
To be completed upon ticket closure (record any key mapping complexities discovered).
