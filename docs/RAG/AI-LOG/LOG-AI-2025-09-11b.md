---
node_id: LOG-AI-2025-09-11b
tags:
  - AI-log
  - development-summary
  - contracts
  - index
  - graph
  - path
  - ci
  - tests
closed_tickets: []
created_date: 2025-09-11
related_files:
  - src/commands/validate_cmd.rs
  - src/index.rs
  - src/discovery/unified.rs
  - src/commands/graph.rs
  - src/commands/path.rs
  - src/cli.rs
  - src/bin/cli-rag.rs
  - tests/integration_index_unified.rs
  - tests/integration_graph_json.rs
  - tests/integration_path_json.rs
  - .github/workflows/ci.yml
  - docs/RAG/IMP-AI/AI-IMP-001-contracts-ci-bootstrap.md
  - docs/RAG/IMP-AI/AI-IMP-002-graph-path-contracts-alignment.md
  - docs/RAG/BRIDGE_PLAN_V1.md
confidence_score: 0.9
---

# 2025-09-11-log-ai-phase-2-graph-path

## Work Completed
- Finalized Phase 1 cleanup: validate exits with code 2 on failures; IMP-001 checklist marked complete; CI validates info, validate(dry), resolved.json, and unified index.
- Unified index writer refactor: single authoritative write at `index/adr-index.json`; nodes include computed.degree and computed.lastModified; edges include `{from,to,kind}` and `mentions.locations`.
- Loader upgrade: supports new unified index shape (nodes/edges) and reconstructs `depends_on` from edges.
- Added CI gate: validate unified index JSON against `contracts/v1/index/index.schema.json`.
- Phase 2 (partial â†’ implemented):
  - Graph JSON now emits `{root:{id}, nodes[{id,title,schema}], edges[{from,to,kind}]}` with deterministic ordering.
  - Path JSON now emits `{ok, path[nodes], edges[{from,to,kind,locations}]}`; BFS includes `[[ID]]` mentions; locations captured from source.
  - Resolved CLI flag collision by introducing `--graph-format` (separate from global `--format`).
- Documentation: Bridge Plan updated (Phase 2 scope set to Graph/Path; Phase 1 and Index marked done). New ticket AI-IMP-002 created with sub-issues, checklists, and ACs.

## Issues Encountered
- Pre-commit rustfmt style nits on long, chained JSON assertions in tests. Resolved by reshaping assertions to rustfmt-preferred multi-line form; kept the code readable and deterministic.
- Initial test assumed index path at `.cli-rag/index.json`; corrected to use configured default `index/adr-index.json`.
- Clap flag collision (`--format`) between global output format and graph subcommand format caused a panic; resolved by renaming the graph-specific flag to `--graph-format` and adjusting parsing/wiring.

## Tests Added
- `tests/integration_index_unified.rs`: validates unified index presence and confirms `depends_on` and `mentions` edges with locations.
- `tests/integration_graph_json.rs`: validates graph JSON contract shape and presence of kinded `depends_on` edges.
- `tests/integration_path_json.rs`: validates path JSON contract shape for both `depends_on` and `mentions` cases (with locations).

## Next Steps
- Wire CI validators for Graph and Path per AI-IMP-002:
  - Validate `graph --id ADR-001 --graph-format json` against `contracts/v1/cli/graph.schema.json` on a temp fixture.
  - Validate `path --from ... --to ... --format json` against `contracts/v1/cli/path.schema.json` including a mentions case with locations.
- Confirm deterministic ordering rules across all emitted lists (nodes, edges) and document any tie-breakers.
- Proceed to Search envelope alignment (Phase 3) once Graph/Path CI gates are green.

